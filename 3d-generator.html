<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D Model Generator - ArtSpace</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Model Viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    
    <style>
        :root {
            --primary: #1a1a2e;
            --secondary: #16213e;
            --accent: #e94560;
            --gold: #d4af37;
            --light: #f5f5f5;
            --text: #333;
            --text-light: #666;
            --gradient-ai: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-3d: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--light);
            color: var(--text);
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: white;
        }
        
        .logo-icon {
            width: 35px;
            height: 35px;
            background: var(--gradient-3d);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* Main Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Hero Section */
        .hero {
            text-align: center;
            padding: 30px 20px;
            background: var(--gradient-3d);
            border-radius: 20px;
            color: white;
            margin-bottom: 30px;
        }
        
        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .hero p {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        /* Main Card */
        .main-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .section-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Tab Buttons */
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 140px;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .tab-btn:hover {
            border-color: var(--accent);
        }
        
        .tab-btn.active {
            border-color: #11998e;
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%);
        }
        
        .tab-btn .tab-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .tab-btn .tab-label {
            font-weight: 600;
            color: var(--text);
        }
        
        .tab-btn .tab-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Camera Section */
        .camera-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
        }
        
        #camera-video {
            width: 100%;
            display: block;
        }
        
        #camera-canvas {
            display: none;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .camera-frame {
            width: 80%;
            height: 80%;
            border: 3px dashed rgba(255,255,255,0.5);
            border-radius: 15px;
        }
        
        .camera-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        
        /* Capture Controls */
        .capture-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .capture-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 4px solid var(--accent);
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
            position: relative;
            z-index: 10;
        }
        
        .capture-btn:hover,
        .capture-btn:active {
            transform: scale(1.1);
            background: var(--accent);
        }
        
        .capture-btn:hover .capture-inner,
        .capture-btn:active .capture-inner {
            background: white;
        }
        
        .capture-inner {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--accent);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .control-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-btn.secondary {
            background: var(--light);
            color: var(--text);
        }
        
        .control-btn.primary {
            background: var(--gradient-3d);
            color: white;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Multi-Image Grid */
        .multi-image-section {
            margin-top: 20px;
        }
        
        .multi-image-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .multi-image-header h4 {
            color: var(--primary);
            font-size: 1rem;
        }
        
        .image-count {
            background: var(--gradient-3d);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .image-slot {
            aspect-ratio: 1;
            border: 2px dashed #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background: #fafafa;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        
        .image-slot:hover {
            border-color: var(--accent);
            background: rgba(233, 69, 96, 0.05);
        }
        
        .image-slot.filled {
            border-style: solid;
            border-color: #11998e;
        }
        
        .image-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-slot .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .image-slot:hover .remove-btn {
            opacity: 1;
        }
        
        .image-slot .slot-icon {
            font-size: 1.5rem;
            color: #ccc;
        }
        
        .multi-image-tip {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 12px 15px;
            border-radius: 10px;
            font-size: 0.85rem;
            color: #2e7d32;
        }
        
        /* Upload Section */
        .upload-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }
        
        .upload-area:hover {
            border-color: var(--accent);
            background: rgba(233, 69, 96, 0.05);
        }
        
        .upload-area.dragover {
            border-color: var(--accent);
            background: rgba(233, 69, 96, 0.1);
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .upload-text {
            color: var(--text-light);
        }
        
        #file-input, #glb-input {
            display: none;
        }
        
        /* GLB Import Section */
        .glb-upload-area {
            border: 2px dashed #11998e;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.05) 0%, rgba(56, 239, 125, 0.05) 100%);
        }
        
        .glb-upload-area:hover {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%);
        }
        
        .glb-upload-area.dragover {
            background: linear-gradient(135deg, rgba(17, 153, 142, 0.15) 0%, rgba(56, 239, 125, 0.15) 100%);
        }
        
        /* Options Section */
        .options-section {
            margin-top: 25px;
            padding: 20px;
            background: var(--light);
            border-radius: 15px;
        }
        
        .options-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .option-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .option-row:last-child {
            border-bottom: none;
        }
        
        .option-label {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .option-label span {
            font-weight: 500;
        }
        
        .option-label small {
            color: var(--text-light);
            font-size: 0.8rem;
        }
        
        .option-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background: var(--gradient-3d);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        /* Generate Button */
        .generate-btn {
            width: 100%;
            padding: 18px;
            background: var(--gradient-3d);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 25px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(17, 153, 142, 0.4);
        }
        
        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Progress Section */
        .progress-section {
            display: none;
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            border-radius: 15px;
            text-align: center;
        }
        
        .progress-section.visible {
            display: block;
        }
        
        .progress-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(17, 153, 142, 0.2);
            border-top-color: #11998e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .progress-status {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .progress-bar-container {
            background: #ddd;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--gradient-3d);
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .progress-percent {
            margin-top: 10px;
            font-weight: 600;
            color: #11998e;
        }
        
        /* Result Section */
        .result-section {
            display: none;
            margin-top: 25px;
        }
        
        .result-section.visible {
            display: block;
        }
        
        .result-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .result-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .result-header h2 {
            font-family: 'Playfair Display', serif;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .result-header p {
            color: var(--text-light);
        }
        
        .model-viewer-container {
            width: 100%;
            height: 400px;
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            position: relative;
        }
        
        model-viewer {
            width: 100%;
            height: 100%;
        }
        
        .model-viewer-container .ar-button-custom {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            position: absolute;
            bottom: 16px;
            right: 16px;
            cursor: pointer;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }
        
        .model-viewer-container .ar-button-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.5);
        }
        
        /* Add to Gallery Section */
        .add-to-gallery-section {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border-radius: 15px;
        }
        
        .add-to-gallery-section h4 {
            color: #f57c00;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .gallery-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .gallery-form input {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 0.95rem;
        }
        
        .gallery-form input:focus {
            outline: none;
            border-color: #f57c00;
        }
        
        .add-gallery-btn {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .add-gallery-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 124, 0, 0.4);
        }
        
        .result-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .result-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .result-btn.primary {
            background: var(--gradient-3d);
            color: white;
        }
        
        .result-btn.secondary {
            background: var(--light);
            color: var(--text);
        }
        
        .result-btn.ar {
            background: var(--accent);
            color: white;
        }
        
        .result-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        /* Error Message */
        .error-message {
            display: none;
            background: #ffebee;
            color: #c62828;
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .error-message.visible {
            display: block;
        }
        
        /* Success Message */
        .success-message {
            display: none;
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }
        
        .success-message.visible {
            display: block;
        }
        
        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .info-box h4 {
            color: #1565c0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-box ul {
            color: #1976d2;
            margin-left: 20px;
            font-size: 0.9rem;
        }
        
        .info-box li {
            margin-bottom: 5px;
        }
        
        /* Credits Display */
        .credits-info {
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .credits-info span {
            font-weight: 600;
            color: #f57c00;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .hero h1 {
                font-size: 1.5rem;
            }
            
            .capture-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .result-actions {
                flex-direction: column;
            }
            
            .result-btn {
                width: 100%;
                justify-content: center;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: 100%;
            }
            
            .image-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                        <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                </div>
                3D Generator
            </a>
            <a href="index.html" class="back-btn">‚Üê Back to Gallery</a>
        </div>
    </header>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Hero -->
        <div class="hero">
            <h1>Turn Photos into 3D Models</h1>
            <p>Capture up to 4 images from different angles for better 3D conversion</p>
            <div class="ai-badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                </svg>
                Powered by Meshy.ai
            </div>
        </div>
        
        <!-- Main Card -->
        <div class="main-card">
            <h2 class="section-title">
                üé® Choose Your Method
            </h2>
            
            <!-- Tab Buttons -->
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="generate">
                    <div class="tab-icon">üì∏</div>
                    <div class="tab-label">Generate 3D</div>
                    <div class="tab-desc">From photos (1-4)</div>
                </button>
                <button class="tab-btn" data-tab="import">
                    <div class="tab-icon">üì¶</div>
                    <div class="tab-label">Import Model</div>
                    <div class="tab-desc">Upload GLB/GLTF</div>
                </button>
            </div>
            
            <!-- Tab: Generate 3D -->
            <div class="tab-content active" id="tab-generate">
                <!-- Camera Section -->
                <div class="camera-container" id="camera-container">
                    <video id="camera-video" autoplay playsinline></video>
                    <canvas id="camera-canvas"></canvas>
                    <div class="camera-overlay">
                        <div class="camera-frame"></div>
                    </div>
                    <div class="camera-hint">Position object in frame</div>
                </div>
                
                <div class="capture-controls" id="camera-controls">
                    <button class="control-btn secondary" id="switch-camera-btn">
                        üîÑ Switch
                    </button>
                    <button class="capture-btn" id="capture-btn">
                        <div class="capture-inner"></div>
                    </button>
                    <button class="control-btn secondary" id="stop-camera-btn">
                        ‚úï Close
                    </button>
                </div>
                
                <!-- Start Camera Button (shown when camera is off) -->
                <div id="start-camera-section" style="text-align: center; margin-top: 20px; display: none;">
                    <button class="control-btn primary" id="start-camera-btn">
                        üì∑ Start Camera
                    </button>
                </div>
                
                <!-- Multi-Image Grid -->
                <div class="multi-image-section" id="multi-image-section">
                    <div class="multi-image-header">
                        <h4>üì∑ Captured Images</h4>
                        <span class="image-count" id="image-count">0/4</span>
                    </div>
                    <div class="image-grid" id="image-grid">
                        <div class="image-slot" data-index="0">
                            <span class="slot-icon">+</span>
                        </div>
                        <div class="image-slot" data-index="1">
                            <span class="slot-icon">+</span>
                        </div>
                        <div class="image-slot" data-index="2">
                            <span class="slot-icon">+</span>
                        </div>
                        <div class="image-slot" data-index="3">
                            <span class="slot-icon">+</span>
                        </div>
                    </div>
                    <div class="multi-image-tip">
                        üí° <strong>Tip:</strong> Add 2-4 images from different angles (front, side, back) for better 3D results!
                    </div>
                </div>
                
                <!-- Upload Section -->
                <div class="upload-section" id="image-upload-section">
                    <p style="text-align: center; color: var(--text-light); margin-bottom: 15px;">‚Äî or upload images ‚Äî</p>
                    <div class="upload-area" id="upload-area">
                        <div class="upload-icon">üìÅ</div>
                        <p class="upload-text">Click or drag & drop images here</p>
                        <p style="font-size: 0.85rem; color: #999; margin-top: 5px;">Supports JPG, JPEG, PNG (up to 4 images)</p>
                    </div>
                    <input type="file" id="file-input" accept="image/jpeg,image/jpg,image/png" multiple>
                </div>
                
                <!-- Options Section -->
                <div class="options-section" id="options-section">
                    <h3 class="options-title">‚öôÔ∏è Generation Options</h3>
                    
                    <div class="option-row">
                        <div class="option-label">
                            <span>AI Model</span>
                            <small>Latest model provides best results</small>
                        </div>
                        <select class="option-select" id="ai-model">
                            <option value="latest">Meshy 6 (Latest)</option>
                            <option value="meshy-5">Meshy 5</option>
                        </select>
                    </div>
                    
                    <div class="option-row">
                        <div class="option-label">
                            <span>Generate Textures</span>
                            <small>Add realistic textures to the model</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="should-texture" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="option-row">
                        <div class="option-label">
                            <span>PBR Maps</span>
                            <small>Metallic, roughness, normal maps</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="enable-pbr">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="credits-info">
                        <span>üíé Estimated Credits: <span id="credit-estimate">30</span></span>
                        <small style="color: #666;">Based on selected options</small>
                    </div>
                </div>
                
                <!-- Generate Button -->
                <button class="generate-btn" id="generate-btn" disabled>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    </svg>
                    Generate 3D Model
                </button>
            </div>
            
            <!-- Tab: Import Model -->
            <div class="tab-content" id="tab-import">
                <div class="glb-upload-area" id="glb-upload-area">
                    <div class="upload-icon">üì¶</div>
                    <p style="font-size: 1.1rem; font-weight: 600; color: var(--primary); margin-bottom: 10px;">Import 3D Model</p>
                    <p class="upload-text">Click or drag & drop a 3D model file here</p>
                    <p style="font-size: 0.85rem; color: #999; margin-top: 10px;">Supports GLB, GLTF formats</p>
                </div>
                <input type="file" id="glb-input" accept=".glb,.gltf">
                
                <div style="margin-top: 20px; padding: 15px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 10px;">
                    <p style="color: #2e7d32; font-size: 0.9rem;">
                        <strong>üí° Tip:</strong> Import existing 3D models to view them in AR or add them to your gallery collection.
                    </p>
                </div>
            </div>
            
            <!-- Error Message -->
            <div class="error-message" id="error-message"></div>
            
            <!-- Progress Section -->
            <div class="progress-section" id="progress-section">
                <div class="progress-spinner"></div>
                <div class="progress-text" id="progress-text">Creating your 3D model...</div>
                <div class="progress-status" id="progress-status">Initializing...</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <div class="progress-percent" id="progress-percent">0%</div>
            </div>
        </div>
        
        <!-- Result Section -->
        <div class="result-section" id="result-section">
            <div class="result-card">
                <div class="result-header">
                    <h2>üéâ Your 3D Model is Ready!</h2>
                    <p>Interact with your model below or view it in AR</p>
                </div>
                
                <div class="model-viewer-container">
                    <model-viewer 
                        id="result-model-viewer"
                        camera-controls 
                        auto-rotate 
                        shadow-intensity="1"
                        exposure="1"
                        ar
                        ar-modes="webxr scene-viewer quick-look"
                        ar-scale="auto"
                        ar-placement="floor wall"
                        ios-src=""
                        style="width: 100%; height: 100%;">
                        <button slot="ar-button" style="
                            background: var(--accent);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 25px;
                            font-weight: 600;
                            position: absolute;
                            bottom: 16px;
                            right: 16px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        ">
                            üëÅÔ∏è View in AR
                        </button>
                    </model-viewer>
                </div>
                
                <!-- Add to Gallery Section -->
                <div class="add-to-gallery-section" id="add-to-gallery-section">
                    <h4>üñºÔ∏è Add to Your Gallery</h4>
                    <div class="gallery-form">
                        <input type="text" id="model-title" placeholder="Model Title (e.g., My Sculpture)">
                        <input type="text" id="model-artist" placeholder="Artist Name (optional)">
                        <button class="add-gallery-btn" id="add-gallery-btn">
                            ‚ûï Add to Gallery
                        </button>
                    </div>
                    <div class="success-message" id="gallery-success">
                        ‚úÖ Model added to your gallery! View it on the main page.
                    </div>
                </div>
                
                <div class="result-actions" id="result-actions">
                    <a class="result-btn primary" id="download-glb" href="#" download="model.glb">
                        üì• Download GLB
                    </a>
                    <a class="result-btn secondary" id="download-fbx" href="#" download="model.fbx" style="display: none;">
                        üì• Download FBX
                    </a>
                    <a class="result-btn secondary" id="download-obj" href="#" download="model.obj" style="display: none;">
                        üì• Download OBJ
                    </a>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="control-btn secondary" id="new-model-btn">
                        ‚ûï Create Another Model
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Info Box -->
        <div class="info-box">
            <h4>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4M12 8h.01"/>
                </svg>
                Tips for Best Results
            </h4>
            <ul>
                <li><strong>Multiple angles:</strong> Take 2-4 photos from different angles (front, side, back)</li>
                <li>Use a plain, contrasting background</li>
                <li>Ensure good, even lighting without harsh shadows</li>
                <li>Avoid reflective or transparent objects</li>
                <li>Higher resolution images produce better 3D models</li>
            </ul>
        </div>
    </div>
    
    <script>
        // Meshy.ai API Key
        const MESHY_API_KEY = 'msy_lzjCzq1NuuNTcdypfDc4LqX4fcVbHxeilx05';
        const MESHY_API_BASE = 'https://api.meshy.ai/openapi/v1';
        
        // State
        let currentStream = null;
        let facingMode = 'environment';
        let capturedImages = []; // Array to store up to 4 images
        let currentTaskId = null;
        let pollInterval = null;
        let currentModelUrls = null;
        let importedModelUrl = null;
        let currentModelData = null; // Store model data for gallery
        
        // DOM Elements
        const cameraContainer = document.getElementById('camera-container');
        const cameraVideo = document.getElementById('camera-video');
        const cameraCanvas = document.getElementById('camera-canvas');
        const cameraControls = document.getElementById('camera-controls');
        const startCameraSection = document.getElementById('start-camera-section');
        const captureBtn = document.getElementById('capture-btn');
        const switchCameraBtn = document.getElementById('switch-camera-btn');
        const stopCameraBtn = document.getElementById('stop-camera-btn');
        const startCameraBtn = document.getElementById('start-camera-btn');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const generateBtn = document.getElementById('generate-btn');
        const progressSection = document.getElementById('progress-section');
        const progressText = document.getElementById('progress-text');
        const progressStatus = document.getElementById('progress-status');
        const progressBar = document.getElementById('progress-bar');
        const progressPercent = document.getElementById('progress-percent');
        const resultSection = document.getElementById('result-section');
        const errorMessage = document.getElementById('error-message');
        const modelViewer = document.getElementById('result-model-viewer');
        const glbUploadArea = document.getElementById('glb-upload-area');
        const glbInput = document.getElementById('glb-input');
        const imageGrid = document.getElementById('image-grid');
        const imageCount = document.getElementById('image-count');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initCamera();
            setupEventListeners();
            setupTabs();
            setupGLBImport();
            setupImageSlots();
            updateCreditEstimate();
        });
        
        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    document.getElementById(`tab-${tabId}`).classList.add('active');
                });
            });
        }
        
        function setupImageSlots() {
            document.querySelectorAll('.image-slot').forEach(slot => {
                const handleSlotClick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    const index = parseInt(slot.dataset.index);
                    console.log('Image slot clicked:', index);
                    if (capturedImages[index]) {
                        // If slot has image, do nothing (use remove button)
                    } else {
                        // Click to upload
                        fileInput.click();
                    }
                };
                slot.addEventListener('click', handleSlotClick);
                slot.addEventListener('touchend', handleSlotClick, { passive: false });
            });
        }
        
        function updateImageGrid() {
            const slots = document.querySelectorAll('.image-slot');
            slots.forEach((slot, index) => {
                if (capturedImages[index]) {
                    slot.classList.add('filled');
                    slot.innerHTML = `
                        <img src="${capturedImages[index]}" alt="Image ${index + 1}">
                        <button class="remove-btn" onclick="removeImage(${index}, event)">√ó</button>
                    `;
                } else {
                    slot.classList.remove('filled');
                    slot.innerHTML = '<span class="slot-icon">+</span>';
                }
            });
            
            imageCount.textContent = `${capturedImages.filter(Boolean).length}/4`;
            generateBtn.disabled = capturedImages.filter(Boolean).length === 0;
        }
        
        function removeImage(index, event) {
            event.stopPropagation();
            capturedImages[index] = null;
            // Compact the array
            capturedImages = capturedImages.filter(Boolean);
            while (capturedImages.length < 4) {
                capturedImages.push(null);
            }
            updateImageGrid();
        }
        
        function addImage(imageData) {
            // Find first empty slot
            const emptyIndex = capturedImages.findIndex(img => !img);
            if (emptyIndex !== -1 && emptyIndex < 4) {
                capturedImages[emptyIndex] = imageData;
                updateImageGrid();
                return true;
            }
            return false;
        }
        
        function setupGLBImport() {
            glbUploadArea.addEventListener('click', () => glbInput.click());
            
            glbUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                glbUploadArea.classList.add('dragover');
            });
            
            glbUploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                glbUploadArea.classList.remove('dragover');
            });
            
            glbUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                glbUploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && (file.name.endsWith('.glb') || file.name.endsWith('.gltf'))) {
                    handleGLBFile(file);
                } else {
                    showError('Please upload a GLB or GLTF file');
                }
            });
            
            glbInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    handleGLBFile(file);
                }
            });
        }
        
        function handleGLBFile(file) {
            importedModelUrl = URL.createObjectURL(file);
            currentModelData = {
                glbUrl: importedModelUrl,
                fileName: file.name,
                isImported: true
            };
            showImportedModel(importedModelUrl, file.name);
        }
        
        function showImportedModel(modelUrl, fileName) {
            document.querySelector('.main-card').style.display = 'none';
            resultSection.classList.add('visible');
            
            modelViewer.src = modelUrl;
            
            document.querySelector('.result-header h2').textContent = 'üì¶ Imported Model';
            document.querySelector('.result-header p').textContent = fileName;
            
            const downloadGlb = document.getElementById('download-glb');
            downloadGlb.href = modelUrl;
            downloadGlb.download = fileName;
            downloadGlb.style.display = 'inline-flex';
            
            document.getElementById('download-fbx').style.display = 'none';
            document.getElementById('download-obj').style.display = 'none';
            
            // Pre-fill title with filename
            document.getElementById('model-title').value = fileName.replace(/\.(glb|gltf)$/i, '');
            
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        async function initCamera() {
            try {
                await startCamera();
            } catch (error) {
                console.log('Camera not available, showing upload option');
                cameraContainer.style.display = 'none';
                cameraControls.style.display = 'none';
                startCameraSection.style.display = 'block';
            }
        }
        
        async function startCamera() {
            try {
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
                
                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    }
                };
                
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraVideo.srcObject = currentStream;
                
                cameraContainer.style.display = 'block';
                cameraControls.style.display = 'flex';
                startCameraSection.style.display = 'none';
                
            } catch (error) {
                throw error;
            }
        }
        
        function setupEventListeners() {
            // Capture button - use touchstart for immediate response on mobile
            if (captureBtn) {
                captureBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Capture button clicked');
                    captureImage();
                });
                captureBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Capture button touched');
                    captureImage();
                }, { passive: false });
            }
            
            if (switchCameraBtn) {
                switchCameraBtn.addEventListener('click', switchCamera);
                switchCameraBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    switchCamera();
                }, { passive: false });
            }
            
            if (stopCameraBtn) {
                stopCameraBtn.addEventListener('click', stopCamera);
                stopCameraBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    stopCamera();
                }, { passive: false });
            }
            
            if (startCameraBtn) {
                startCameraBtn.addEventListener('click', startCamera);
                startCameraBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    startCamera();
                }, { passive: false });
            }
            
            // Upload area
            if (uploadArea) {
                uploadArea.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('Upload area clicked');
                    fileInput.click();
                });
                uploadArea.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    console.log('Upload area touched');
                    fileInput.click();
                }, { passive: false });
                uploadArea.addEventListener('dragover', handleDragOver);
                uploadArea.addEventListener('dragleave', handleDragLeave);
                uploadArea.addEventListener('drop', handleDrop);
            }
            
            if (fileInput) {
                fileInput.addEventListener('change', handleFileSelect);
            }
            
            generateBtn.addEventListener('click', generateModel);
            
            document.getElementById('should-texture').addEventListener('change', updateCreditEstimate);
            document.getElementById('enable-pbr').addEventListener('change', updateCreditEstimate);
            
            document.getElementById('new-model-btn').addEventListener('click', resetToStart);
            
            // Add to gallery button
            document.getElementById('add-gallery-btn').addEventListener('click', addToGallery);
        }
        
        function captureImage() {
            if (capturedImages.filter(Boolean).length >= 4) {
                showError('Maximum 4 images allowed. Remove one to add more.');
                return;
            }
            
            const context = cameraCanvas.getContext('2d');
            cameraCanvas.width = cameraVideo.videoWidth;
            cameraCanvas.height = cameraVideo.videoHeight;
            context.drawImage(cameraVideo, 0, 0);
            
            const imageData = cameraCanvas.toDataURL('image/jpeg', 0.9);
            addImage(imageData);
        }
        
        async function switchCamera() {
            facingMode = facingMode === 'environment' ? 'user' : 'environment';
            await startCamera();
        }
        
        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            cameraContainer.style.display = 'none';
            cameraControls.style.display = 'none';
            startCameraSection.style.display = 'block';
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));
            processFiles(files);
        }
        
        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }
        
        function processFiles(files) {
            console.log('Processing files:', files.length);
            const currentCount = capturedImages.filter(Boolean).length;
            const availableSlots = 4 - currentCount;
            const filesToProcess = files.slice(0, availableSlots);
            console.log('Files to process:', filesToProcess.length);
            
            filesToProcess.forEach(file => {
                console.log('Processing file:', file.name, file.type);
                const reader = new FileReader();
                reader.onload = (e) => {
                    console.log('File loaded, adding image');
                    addImage(e.target.result);
                };
                reader.readAsDataURL(file);
            });
            
            if (files.length > availableSlots) {
                showError(`Only ${availableSlots} more image(s) can be added. Some images were skipped.`);
            }
        }
        
        function updateCreditEstimate() {
            const shouldTexture = document.getElementById('should-texture').checked;
            let credits = 20;
            if (shouldTexture) credits += 10;
            document.getElementById('credit-estimate').textContent = credits;
        }
        
        async function generateModel() {
            const images = capturedImages.filter(Boolean);
            if (images.length === 0) {
                showError('Please capture or upload at least one image');
                return;
            }
            
            const aiModel = document.getElementById('ai-model').value;
            const shouldTexture = document.getElementById('should-texture').checked;
            const enablePbr = document.getElementById('enable-pbr').checked;
            
            progressSection.classList.add('visible');
            generateBtn.disabled = true;
            errorMessage.classList.remove('visible');
            updateProgress(0, 'Uploading images...');
            
            try {
                let response;
                
                if (images.length === 1) {
                    // Single image API
                    response = await fetch(`${MESHY_API_BASE}/image-to-3d`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${MESHY_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            image_url: images[0],
                            ai_model: aiModel,
                            should_texture: shouldTexture,
                            enable_pbr: enablePbr
                        })
                    });
                } else {
                    // Multi-image API (2-4 images)
                    response = await fetch(`${MESHY_API_BASE}/multi-image-to-3d`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${MESHY_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            image_urls: images,
                            ai_model: aiModel,
                            should_texture: shouldTexture,
                            enable_pbr: enablePbr
                        })
                    });
                }
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `API Error: ${response.status}`);
                }
                
                const data = await response.json();
                currentTaskId = data.result;
                
                updateProgress(5, 'Task created, processing...');
                pollTaskStatus(images.length > 1);
                
            } catch (error) {
                console.error('Error:', error);
                showError(`Failed to start generation: ${error.message}`);
                progressSection.classList.remove('visible');
                generateBtn.disabled = false;
            }
        }
        
        function pollTaskStatus(isMultiImage = false) {
            const endpoint = isMultiImage ? 'multi-image-to-3d' : 'image-to-3d';
            
            pollInterval = setInterval(async () => {
                try {
                    const response = await fetch(`${MESHY_API_BASE}/${endpoint}/${currentTaskId}`, {
                        headers: {
                            'Authorization': `Bearer ${MESHY_API_KEY}`
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Status check failed: ${response.status}`);
                    }
                    
                    const task = await response.json();
                    const progress = task.progress || 0;
                    updateProgress(progress, getStatusText(task.status));
                    
                    if (task.status === 'SUCCEEDED') {
                        clearInterval(pollInterval);
                        showResult(task);
                    } else if (task.status === 'FAILED') {
                        clearInterval(pollInterval);
                        showError(task.task_error?.message || 'Model generation failed');
                        progressSection.classList.remove('visible');
                        generateBtn.disabled = false;
                    } else if (task.status === 'EXPIRED') {
                        clearInterval(pollInterval);
                        showError('Task expired. Please try again.');
                        progressSection.classList.remove('visible');
                        generateBtn.disabled = false;
                    }
                    
                } catch (error) {
                    console.error('Poll error:', error);
                }
            }, 3000);
        }
        
        function getStatusText(status) {
            switch (status) {
                case 'PENDING': return 'Waiting in queue...';
                case 'IN_PROGRESS': return 'Generating 3D model...';
                case 'SUCCEEDED': return 'Complete!';
                case 'FAILED': return 'Failed';
                case 'EXPIRED': return 'Expired';
                default: return 'Processing...';
            }
        }
        
        function updateProgress(percent, status) {
            progressBar.style.width = `${percent}%`;
            progressPercent.textContent = `${percent}%`;
            progressStatus.textContent = status;
            
            if (percent < 30) {
                progressText.textContent = 'Analyzing images...';
            } else if (percent < 60) {
                progressText.textContent = 'Building 3D geometry...';
            } else if (percent < 90) {
                progressText.textContent = 'Applying textures...';
            } else {
                progressText.textContent = 'Finalizing model...';
            }
        }
        
        function showResult(task) {
            progressSection.classList.remove('visible');
            document.querySelector('.main-card').style.display = 'none';
            resultSection.classList.add('visible');
            
            document.querySelector('.result-header h2').textContent = 'üéâ Your 3D Model is Ready!';
            document.querySelector('.result-header p').textContent = 'Interact with your model below or view it in AR';
            
            currentModelUrls = task.model_urls;
            currentModelData = {
                glbUrl: task.model_urls?.glb,
                thumbnailUrl: task.thumbnail_url,
                isGenerated: true
            };
            
            if (task.model_urls && task.model_urls.glb) {
                modelViewer.src = task.model_urls.glb;
                
                if (task.model_urls.usdz) {
                    modelViewer.setAttribute('ios-src', task.model_urls.usdz);
                }
            }
            
            if (task.model_urls) {
                const downloadGlb = document.getElementById('download-glb');
                const downloadFbx = document.getElementById('download-fbx');
                const downloadObj = document.getElementById('download-obj');
                
                if (task.model_urls.glb) {
                    downloadGlb.href = task.model_urls.glb;
                    downloadGlb.style.display = 'inline-flex';
                }
                if (task.model_urls.fbx) {
                    downloadFbx.href = task.model_urls.fbx;
                    downloadFbx.style.display = 'inline-flex';
                }
                if (task.model_urls.obj) {
                    downloadObj.href = task.model_urls.obj;
                    downloadObj.style.display = 'inline-flex';
                }
            }
            
            // Clear title field for new entry
            document.getElementById('model-title').value = '';
            document.getElementById('model-artist').value = '';
            document.getElementById('gallery-success').classList.remove('visible');
            
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function addToGallery() {
            const title = document.getElementById('model-title').value.trim();
            const artist = document.getElementById('model-artist').value.trim() || 'User Created';
            
            if (!title) {
                alert('Please enter a title for your model');
                return;
            }
            
            if (!currentModelData || !currentModelData.glbUrl) {
                alert('No model available to add');
                return;
            }
            
            // Create artwork object
            const newArtwork = {
                id: Date.now(),
                title: title,
                artist: artist,
                medium: currentModelData.isImported ? 'Imported 3D Model' : 'AI Generated 3D Model',
                style: 'User Created',
                price: 'Personal Collection',
                dimensions: { width: 30, height: 30, depth: 30 },
                model: currentModelData.glbUrl,
                type: '3d',
                badge: currentModelData.isImported ? 'Imported' : 'AI Generated',
                category: 'user-created',
                tags: ['user-created', 'custom', '3d-scan'],
                description: `Created with ArtSpace 3D Generator`,
                isUserCreated: true,
                createdAt: new Date().toISOString()
            };
            
            // Save to localStorage
            try {
                const userArtworks = JSON.parse(localStorage.getItem('artspace_user_artworks') || '[]');
                userArtworks.unshift(newArtwork);
                localStorage.setItem('artspace_user_artworks', JSON.stringify(userArtworks));
                
                // Show success message
                document.getElementById('gallery-success').classList.add('visible');
                
                // Disable button temporarily
                const btn = document.getElementById('add-gallery-btn');
                btn.textContent = '‚úÖ Added!';
                btn.disabled = true;
                
                setTimeout(() => {
                    btn.textContent = '‚ûï Add to Gallery';
                    btn.disabled = false;
                }, 3000);
                
            } catch (e) {
                console.error('Error saving to gallery:', e);
                alert('Failed to save to gallery. Please try again.');
            }
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('visible');
            setTimeout(() => {
                errorMessage.classList.remove('visible');
            }, 5000);
        }
        
        function resetToStart() {
            capturedImages = [null, null, null, null];
            currentTaskId = null;
            currentModelUrls = null;
            currentModelData = null;
            importedModelUrl = null;
            
            if (pollInterval) {
                clearInterval(pollInterval);
            }
            
            updateImageGrid();
            progressSection.classList.remove('visible');
            resultSection.classList.remove('visible');
            errorMessage.classList.remove('visible');
            generateBtn.disabled = true;
            
            document.querySelector('.main-card').style.display = 'block';
            
            fileInput.value = '';
            glbInput.value = '';
            
            progressBar.style.width = '0%';
            progressPercent.textContent = '0%';
            
            modelViewer.src = '';
            
            initCamera();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Listen for model-viewer AR status
        modelViewer.addEventListener('ar-status', (event) => {
            console.log('AR Status:', event.detail.status);
        });
    </script>
</body>
</html>
